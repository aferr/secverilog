/* crypto/sha/sha512t.c */
/* ====================================================================
 * Copyright (c) 2004 The OpenSSL Project.  All rights reserved.
 * ====================================================================
 */
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#include <openssl/sha.h>
#include <openssl/evp.h>
#include <openssl/crypto.h>

#if defined(OPENSSL_NO_SHA) || defined(OPENSSL_NO_SHA512)
int main(int argc, char *argv[])
{
    printf("No SHA512 support\n");
    return(0);
}
#else

unsigned char app_c1[SHA512_DIGEST_LENGTH] = {
	0xdd,0xaf,0x35,0xa1,0x93,0x61,0x7a,0xba,
	0xcc,0x41,0x73,0x49,0xae,0x20,0x41,0x31,
	0x12,0xe6,0xfa,0x4e,0x89,0xa9,0x7e,0xa2,
	0x0a,0x9e,0xee,0xe6,0x4b,0x55,0xd3,0x9a,
	0x21,0x92,0x99,0x2a,0x27,0x4f,0xc1,0xa8,
	0x36,0xba,0x3c,0x23,0xa3,0xfe,0xeb,0xbd,
	0x45,0x4d,0x44,0x23,0x64,0x3c,0xe8,0x0e,
	0x2a,0x9a,0xc9,0x4f,0xa5,0x4c,0xa4,0x9f };

unsigned char app_c2[SHA512_DIGEST_LENGTH] = {
	0x3f,0xe3,0x1c,0x9f,0xfe,0xfc,0x54,0xed,
	0xee,0xdb,0xf2,0x88,0x01,0x67,0x2f,0xd9,
	0xf0,0x57,0xae,0xf2,0x29,0x82,0x47,0x30,
	0xf3,0xe3,0x1f,0xa4,0x42,0xe6,0x4b,0xa1,
	0x94,0x9f,0xda,0x68,0x07,0xaa,0x2d,0x63,
	0x0e,0xc2,0x3b,0x1d,0x4d,0xcf,0xaf,0x8b,
	0x41,0x15,0x32,0x73,0x06,0xf8,0x22,0xd4,
	0x51,0xad,0xcc,0xf7,0x43,0xd9,0x9e,0x1a };

unsigned char app_c3[SHA512_DIGEST_LENGTH] = {
	0x4b,0x50,0xc9,0x4f,0x6b,0x8e,0x19,0x0a,
	0xac,0xf0,0xf7,0x4e,0xe9,0x83,0x0e,0xc2,
	0x8b,0x49,0xf4,0xbe,0x4c,0xad,0x2a,0x73,
	0x16,0x2c,0x2d,0xb8,0x2d,0x87,0x4d,0xdb,
	0x2f,0xeb,0xe8,0xe8,0x92,0x72,0x94,0xd5,
	0x36,0xcb,0x12,0x70,0xb2,0x68,0x26,0x4d,
	0x28,0x4b,0x8b,0x87,0xd0,0x85,0x2a,0x40,
	0x8d,0x82,0x2e,0x8a,0xca,0xbc,0x63,0xb6 };

unsigned char app_d1[SHA384_DIGEST_LENGTH] = {
	0xcb,0x00,0x75,0x3f,0x45,0xa3,0x5e,0x8b,
	0xb5,0xa0,0x3d,0x69,0x9a,0xc6,0x50,0x07,
	0x27,0x2c,0x32,0xab,0x0e,0xde,0xd1,0x63,
	0x1a,0x8b,0x60,0x5a,0x43,0xff,0x5b,0xed,
	0x80,0x86,0x07,0x2b,0xa1,0xe7,0xcc,0x23,
	0x58,0xba,0xec,0xa1,0x34,0xc8,0x25,0xa7 };

unsigned char app_d2[SHA384_DIGEST_LENGTH] = {
	0xa5,0x59,0x50,0xb6,0x13,0x64,0x43,0xbf,
	0xbb,0xae,0x18,0x24,0x08,0x27,0x3f,0x3d,
	0x50,0x1f,0x82,0x35,0xa6,0x71,0xdd,0x39,
	0x5c,0xbe,0x77,0x70,0x5f,0x82,0x2b,0x6c,
	0x30,0x69,0xba,0x8d,0xbb,0x5b,0x2a,0x23,
	0xcd,0x36,0xcb,0xaa,0x0e,0xb8,0x4e,0x6b };

unsigned char app_d3[SHA384_DIGEST_LENGTH] = {
	0x0f,0x96,0xb7,0x23,0x83,0x6e,0x0e,0x94,
	0xb1,0x92,0xdf,0x66,0xff,0xc3,0xd8,0x97,
	0xd5,0x94,0x8a,0x43,0xd6,0x80,0x2d,0x81,
	0x82,0x3c,0xb1,0x09,0x5a,0x67,0x79,0x78,
	0x10,0x27,0x15,0x4c,0xcf,0x75,0x72,0xe9,
	0x1f,0xea,0x98,0x28,0x11,0xf3,0xbc,0x9e };

int main (int argc,char **argv)
{ unsigned char md[SHA512_DIGEST_LENGTH];
  int		i;
  EVP_MD_CTX	evp;

#ifdef OPENSSL_IA32_SSE2
    /* Alternative to this is to call OpenSSL_add_all_algorithms...
     * The below code is retained exclusively for debugging purposes. */
    { char      *env;

	if ((env=getenv("OPENSSL_ia32cap")))
	    OPENSSL_ia32cap = strtoul (env,NULL,0);
    }
#endif

    fprintf(stdout,"Testing SHA-512 ");

    EVP_Digest ("abc",3,md,NULL,EVP_sha512(),NULL);
    if (memcmp(md,app_c1,sizeof(app_c1)))
    {	fflush(stdout);
	fprintf(stderr,"\nTEST 1 of 3 failed.\n");
	return 1;
    }
    else
	fprintf(stdout,"."); fflush(stdout);

    EVP_Digest ("abcdefgh""bcdefghi""cdefghij""defghijk"
		"efghijkl""fghijklm""ghijklmn""hijklmno"
		"ijklmnop""jklmnopq""klmnopqr""lmnopqrs"
		"mnopqrst""nopqrstu",112,md,NULL,EVP_sha512(),NULL);
    if (memcmp(md,app_c2,sizeof(app_c2)))
    {	fflush(stdout);
	fprintf(stderr,"\nTEST 2 of 3 failed.\n");
	return 1;
    }
    else
	fprintf(stdout,"."); fflush(stdout);

    EVP_MD_CTX_init (&evp);
    EVP_DigestInit_ex (&evp,EVP_sha512(),NULL);
    SETH
    for (i=0;i<10000;i+=288)
	EVP_DigestUpdate (&evp,	"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa",
				(1000000-i)<288?1000000-i:288);
    EVP_DigestFinal_ex (&evp,md,NULL);
    SETL
    EVP_MD_CTX_cleanup (&evp);

    if (memcmp(md,app_c3,sizeof(app_c3)))
    {	fflush(stdout);
	fprintf(stderr,"\nTEST 3 of 3 failed.\n");
	return 1;
    }
    else
	fprintf(stdout,"."); fflush(stdout);

    fprintf(stdout," passed.\n"); fflush(stdout);

    fprintf(stdout,"Testing SHA-384 ");

    EVP_Digest ("abc",3,md,NULL,EVP_sha384(),NULL);
    if (memcmp(md,app_d1,sizeof(app_d1)))
    {	fflush(stdout);
	fprintf(stderr,"\nTEST 1 of 3 failed.\n");
	return 1;
    }
    else
	fprintf(stdout,"."); fflush(stdout);

    EVP_Digest ("abcdefgh""bcdefghi""cdefghij""defghijk"
		"efghijkl""fghijklm""ghijklmn""hijklmno"
		"ijklmnop""jklmnopq""klmnopqr""lmnopqrs"
		"mnopqrst""nopqrstu",112,md,NULL,EVP_sha384(),NULL);
    if (memcmp(md,app_d2,sizeof(app_d2)))
    {	fflush(stdout);
	fprintf(stderr,"\nTEST 2 of 3 failed.\n");
	return 1;
    }
    else
	fprintf(stdout,"."); fflush(stdout);

    EVP_MD_CTX_init (&evp);
    EVP_DigestInit_ex (&evp,EVP_sha384(),NULL);
    SETH
    for (i=0;i<10000;i+=64)
	EVP_DigestUpdate (&evp,	"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa"
				"aaaaaaaa""aaaaaaaa""aaaaaaaa""aaaaaaaa",
				(1000000-i)<64?1000000-i:64);
    EVP_DigestFinal_ex (&evp,md,NULL);
    SETL
    EVP_MD_CTX_cleanup (&evp);

    if (memcmp(md,app_d3,sizeof(app_d3)))
    {	fflush(stdout);
	fprintf(stderr,"\nTEST 3 of 3 failed.\n");
	return 1;
    }
    else
	fprintf(stdout,"."); fflush(stdout);

    fprintf(stdout," passed.\n"); fflush(stdout);

  exit (0);
}
#endif
